package hackerrank.medium;

import epp.Pair;

import java.util.ArrayList;
import java.util.List;
import java.util.Stack;

public class LargestRectangle {
    public static void main(String[] args) {
        System.out.println(largestRectangle(new ArrayList<>(List.of(1, 2, 3, 4, 5))));
        System.out.println(largestRectangle(new ArrayList<>(List.of(3,2,3))));
        System.out.println(largestRectangle(new ArrayList<>(List.of(11 ,11, 10, 10, 10))));
        System.out.println(largestRectangle(new ArrayList<>(List.of(4177, 9313, 8851, 7891, 7174, 6944, 9381, 4149, 6053, 1961, 1179, 4528, 4041, 6572, 2214, 4984, 5377, 6652, 9526, 435, 9525, 5286, 7906, 3164, 2163, 9033, 3338, 8471, 6820, 3648, 7223, 998, 9313, 2426, 5241, 6487, 5723, 975, 6988, 1776, 2936, 8168, 2656, 3330, 1092, 4870, 8314, 6469, 1522, 4193, 3257, 7399, 9479, 1163, 6915, 7994, 6548, 253, 6466, 3369, 3901, 41, 719, 9566, 8820, 5960, 2405, 4543, 3287, 9394, 2671, 2576, 3914, 5327, 2258, 5006, 197, 572, 7827, 8071, 1117, 1084, 1822, 6948, 8600, 8737, 4943, 5148, 5342, 1409, 8517, 5595, 7802, 9236, 5161, 6622, 1549, 7566, 1165, 1188, 6960, 3836, 3764, 874, 5515, 6022, 2232, 5712, 2947, 60, 135, 4064, 1144, 1957, 1013, 9744, 7046, 5956, 4893, 8740, 3717, 9762, 4335, 1519, 8999, 9496, 4494, 6900, 3415, 2011, 8088, 6727, 2200, 1853, 3954, 7715, 4227, 6186, 9780, 7174, 6246, 9915, 1239, 3743, 8225, 2252, 3487, 1623, 4560, 4732, 364, 8277, 847, 4699, 6148, 6198, 548, 642, 3098, 3963, 9006, 7538, 7042, 1206, 9391, 996, 8921, 3619, 3535, 8701, 7145, 6133, 4969, 8384, 9876, 9546, 6988, 9716, 1169, 7900, 800, 1533, 6177, 1647, 6233, 8678, 7845, 3133, 5672, 7295, 3448, 4678, 4834, 490, 5884, 4225, 7839, 1158, 4196, 1374, 6211, 7694, 3859, 1180, 2430, 3736, 726, 9419, 9804, 1896, 3671, 604, 9781, 6201, 2252, 2366, 4879, 6449, 5499, 551, 3745, 5299, 1582, 8579, 2142, 7466, 9156, 9981, 8624, 9705, 7707, 4836, 7399, 1566, 2368, 9829, 1654, 9447, 5600, 1458, 7695, 9272, 2063, 7476, 1825, 667, 9843, 6704, 3468, 1694, 3607, 7213, 6994, 5189, 2144, 9136, 2656, 1301, 9117, 7632, 7358, 3176, 8820, 4757, 1094, 1189, 938, 2749, 6988, 2891, 4207, 4683, 8515, 2622, 2159, 340, 3289, 2002, 7044, 3110, 49, 7003, 323, 7043, 2193, 8820, 6179, 1201, 6473, 1648, 8833, 3831, 1176, 4006, 4940, 2270, 1547, 5878, 5019, 8535, 5121, 5579, 3218, 3636, 8201, 5377, 3976, 7843, 3732, 7372, 953, 3781, 4376, 7628, 7176, 6569, 6448, 9707, 7770, 2921, 7707, 2955, 3104, 8883, 6961, 8044, 7505, 8508, 275, 2525, 3395, 5396, 8104, 6613, 9033, 6305, 8343, 9361, 500, 8427, 6734, 1453, 2208, 1110, 5434, 5736, 4031, 1882, 5443, 8153, 1156, 3150, 1108, 4260, 8385, 4422, 2305, 5890, 9282, 2580, 4767, 2678, 4328, 2871, 5643, 3361, 5529, 3986, 9075, 2381, 2413, 5809, 3835, 973, 3271, 9269, 3061, 7302, 7503, 4856, 5455, 8659, 8006, 2915, 9272, 2743, 3689, 7929, 4986, 9324, 6861, 9753, 8354, 1189, 8977, 3997, 903, 858, 4336, 9978, 3239, 3101, 5787, 3426, 427, 9058, 9047, 3488, 2712, 6551, 8345, 4519, 1562, 2703, 3786, 834, 1799, 3828, 5115, 6785, 3152, 1976, 2890, 1506, 3166, 1867, 1855, 4069, 2725, 2543, 4047, 2317, 1997, 6186, 5743, 2424, 1596, 4791, 2264, 4308, 7694, 6961, 5179, 9256, 6017, 8965, 6443, 4168, 2793, 1558, 953, 2297, 3535, 3843, 3803, 6701, 2063, 2011, 7122, 1140, 906, 1169, 3457, 2903, 3707, 9201, 1679, 5303, 344, 296, 9611, 8038, 7257, 1142, 7294, 9626, 107, 89, 3794, 9253, 1648, 1099, 1550, 1535, 4943, 1706, 4588, 3358, 69, 1710, 4498, 975, 9231, 7956, 3879, 2938, 3509, 1910, 8241, 3853, 2206, 4204, 1891, 5816, 1698, 5537, 5442, 1805, 5627, 9237, 7410, 3627, 336, 8961, 5162, 1631, 7019, 9750, 4989, 7088, 7812, 5840, 4415, 7043, 148, 4646, 9981, 3657, 6557, 4574, 3862, 8763, 5130, 5753, 4579, 6828, 7642, 6374, 4985, 9621, 5611, 2396, 3248, 2299, 7709, 4762, 283, 1080, 4512, 5272, 8168, 2324, 7464, 2583, 5719, 7612, 3582, 2052, 1269, 139, 6626, 5131, 5254, 8108, 7236, 6186, 1288, 1231, 2560, 6274, 852, 4523, 5022, 4101, 6822, 9083, 8863, 3457, 163, 9728, 8730, 4683, 8404, 2546, 3618, 4124, 159, 7200, 6176, 7780, 7339, 9155, 9264, 2594, 3615, 2852, 5132, 4904, 4083, 7692, 1178, 4936, 2215, 2552, 5389, 5389, 1635, 604, 8847, 1798, 6684, 3929, 6481, 5089, 6475, 99, 9213, 2986, 7300, 1741, 767, 991, 7248, 31, 9937, 864, 2883, 5069, 5768, 3319, 9113, 3298, 4607, 1328, 5850, 9996, 3070, 7485, 6952, 8269, 5635, 3637, 8550, 2116, 8726, 1377, 8567, 4291, 4364, 2219, 2384, 1483, 3211, 9633, 1514, 9500, 497, 749, 4570, 6265, 420, 35, 9563, 5027, 7716, 1765, 1375, 786, 9250, 8328, 5407, 1237, 1965, 3957, 9705, 7043, 5334, 8272, 7686, 6050, 6844, 70, 7533, 55, 6055, 5399, 5907, 6552, 2501, 6829, 9169, 2921, 6865, 5084, 7949, 4581, 6849, 9324, 1719, 2451, 4004, 7126, 3688, 2321, 7435, 3393, 9364, 2769, 1666, 3402, 5172, 8510, 9825, 2705, 4917, 5880, 8105, 7176, 8785, 606, 4006, 7954, 3527, 871, 9391, 7828, 1804, 6240, 3505, 3523, 8692, 7509, 649, 2380, 9831, 4436, 5774, 5547, 3557, 3792, 5302, 8729, 8654, 5127, 1435, 9923, 7359, 5892, 7099, 6144, 6498, 1105, 451, 6377, 8328, 6194, 558, 132, 2434, 4063, 3655, 7478, 1572, 656, 9859, 7755, 1444, 1985, 9655, 5002, 2129, 4957, 3731, 783, 6436, 5166, 706, 3795, 7410, 7805, 6292, 3908, 5263, 3095, 6638, 3591, 5641, 7196, 76, 8075, 1259, 83, 5554, 9183, 7092, 1765, 3291, 8536, 102, 9298, 3538, 2231, 607, 7270, 9366, 7043, 8788, 6424, 7190, 6199, 4229, 9834, 6459, 5844, 9281, 3097, 5788, 4922, 6645, 5864, 9350, 4256, 5947, 1256, 3440, 3039, 9373, 3083, 1576, 9475, 2381, 5114, 8058, 2988, 8736, 7424, 6383, 7525, 3848, 3573, 76, 4429, 9760, 6535, 6626, 9041, 5985, 2414, 316, 8982, 8278, 9666, 3239, 577, 922, 3031, 3617, 295, 6114, 1545, 6122, 4847, 6659, 4180, 4187, 1748, 7956, 570, 5625, 8156, 495, 5701, 8937, 255, 8588, 5563, 5649, 925, 7977, 5965, 9908, 2607, 1983, 3147, 3185, 2905, 2530, 6802, 9552, 8644, 8347, 2026, 9843, 1358, 2558, 4030, 9458, 514, 952, 5083, 5022, 1447, 7136, 3959, 8055, 2077, 9523, 3704, 3002, 3852, 9669, 9262, 6460, 1652, 8761, 9645, 909, 1291, 2799, 6813, 6287, 1146, 8839, 6130, 8856, 1397, 6512, 8315, 8263, 7464, 3398, 9637, 5264, 535, 3596, 3319, 8964, 9471, 7023, 1966, 9676, 3044, 7581, 6136, 1048, 2694, 2133, 8309, 3986, 4932, 5122, 6625, 6078, 313, 2756, 1286, 8062, 5620, 9601, 2677, 3085, 9352, 2314, 8349, 6239, 2262, 1668, 5203, 1734, 5043, 3521, 1410, 4439, 1102, 3898, 5487, 3797, 6031, 148, 4135, 963, 5270, 760, 3393, 1935, 9868, 4679, 6349, 5489, 4281, 9026, 4926, 9985, 1340, 9627, 6224, 3602, 7647, 1427, 1688))));
       /* System.out.println(largestRectangle(new ArrayList<>(List.of(6873, 7005, 1372, 5438, 1323, 9238, 9184, 2396,
                4605, 162, 7170, 9421, 4012, 5302, 6277, 2438, 4409, 3391, 4956, 4488, 622, 9365, 5088, 6926, 2691, 6909, 1050, 2824, 3538, 5801, 8468, 411, 9158, 9841, 2201, 481, 5431, 1385, 2877, 36, 1547, 48, 5809, 1911, 1702, 8439, 4349, 6111, 1830, 5657, 6951, 8804, 5022, 8391, 2083, 7713, 5300, 3133, 6890, 5190, 5286, 1710, 1953, 4445, 7903, 4154, 4926, 3335, 5539, 4156, 9723, 3438, 556, 1885, 5349, 2258, 324, 6050, 4722, 8506, 1707, 1673, 7310, 3081, 65, 9393, 7147, 1717, 8878, 389, 6908, 4165, 2099, 5213, 8610, 3, 9368, 3536, 9690, 1259))));
   */ }

    public static long largestRectangle(List<Integer> h) {
        // Write your code here

        Stack<Pair<Integer,Integer>> stack = new Stack<>();
        int maxArea = 0;
        for(int i=0;i<h.size();i++){
            Pair<Integer,Integer> building = new Pair<>(h.get(i),i);
            while (!stack.isEmpty()&& stack.peek().getFirst()>building.getFirst()){
                stack.pop();

            }
            Stack<Pair<Integer,Integer>> copy = new Stack<>();
            int maxAreaForCurrentBuilding = 0;
            while (!stack.isEmpty()){
                Pair<Integer, Integer> previous = stack.pop();
                int height = Math.min(building.getFirst(), previous.getFirst());
                int width =  stack.isEmpty()? building.getSecond()+1:  building.getSecond()-stack.peek().getSecond();
                int area = height * width;
                maxAreaForCurrentBuilding=Math.max(maxAreaForCurrentBuilding,area);
               copy.push(previous);

            }


            if(maxAreaForCurrentBuilding>maxArea){
                maxArea = maxAreaForCurrentBuilding;

            }



            while (!copy.isEmpty()){
                stack.push(copy.pop());
            }
            if(stack.isEmpty() || stack.peek().getFirst()< building.getFirst()){
                stack.push(building);
            }

        }
        return maxArea;

    }
}
